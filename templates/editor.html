<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Edit Tasks</title>
<style>
:root{
  --bg:#f5f6f7;--card:#fff;--text:#0b0c0e;--muted:#6a6d75;--divider:#eceef0;
}
@media (prefers-color-scheme: dark){
  :root{--bg:#0d0f12;--card:#14171b;--text:#f3f4f5;--muted:#9aa0a6;--divider:#22262b;}
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:-apple-system,system-ui,sans-serif;line-height:1.35;padding:16px;
}
.wrap{max-width:720px;margin:0 auto;}
.card{background:var(--card);border-radius:18px;padding:18px 12px;box-shadow:0 8px 26px rgba(0,0,0,.08);}
.handle{width:44px;height:4px;background:var(--divider);border-radius:999px;margin:6px auto 10px;}
.title{font-weight:800;font-size:20px;margin:4px 0 2px;}
.date{color:var(--muted);font-size:14px;margin-bottom:12px;}

.controls{display:flex;gap:8px;padding-bottom:10px;}
.input{
  flex:1;border:1px solid var(--divider);background:transparent;color:var(--text);
  padding:12px 14px;border-radius:12px;font-size:16px;
}
.btn{
  border:none;border-radius:12px;padding:12px 16px;font-weight:600;
  background:var(--text);color:var(--card);cursor:pointer;
}
.list{list-style:none;padding:0;margin:0;}
.row{
  display:flex;align-items:center;gap:12px;padding:14px 6px;
  border-bottom:1px solid var(--divider);
}
.chk{width:22px;height:22px;}
.txt{flex:1;font-size:17px;}
.del{background:#c62828;color:white;border:none;border-radius:8px;padding:8px 10px;font-weight:600;}
.muted{color:var(--muted);font-size:13px;margin-top:8px;text-align:center;}

/* âœ… sticky bottom save bar */
.save-bar{
  position:fixed;bottom:0;left:0;right:0;background:var(--card);
  padding:env(safe-area-inset-bottom,12px) 16px 12px;
  border-top:1px solid var(--divider);
  box-shadow:0 -4px 18px rgba(0,0,0,.15);
  display:flex;justify-content:center;
}
.save-btn{
  width:90%;max-width:350px;padding:14px 20px;background:#0a84ff;color:white;
  border:none;font-size:16px;font-weight:600;border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.18);cursor:pointer;
}
.save-btn:active{transform:scale(.97);opacity:.9;}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="handle"></div>
    <div class="title" id="headerTitle"></div>

    <div class="controls">
      <input id="newText" class="input" placeholder="New taskâ€¦" />
      <button class="btn" onclick="addTask()">Add</button>
    </div>

    <ul id="list" class="list"></ul>
    <div class="muted">Toggle tasks and tap Save below.</div>
  </div>
</div>

<div class="save-bar">
  <button class="save-btn" onclick="save()">Save âœ…</button>
</div>

<script>
function showDate(){
  const now=new Date();
  const opt={weekday:"long",month:"short",day:"numeric",year:"numeric"};
  document.getElementById("headerTitle").textContent=`ðŸ›  Edit Tasks (${now.toLocaleDateString(undefined,opt)})`;
}
showDate();

let tasks=[];

async function load(){
  const res = await fetch("/tasks?" + Date.now());
  tasks = await res.json();
  render();
}
function render(){
  const ul=document.getElementById("list");
  ul.innerHTML="";
  if(tasks.length===0){
    ul.innerHTML='<div class="muted" style="padding-top:10px;">No tasks yet â€” add above.</div>';
    return;
  }
  tasks.forEach((t,i)=>{
    const li=document.createElement("li");
    li.className="row";

    const cb=document.createElement("input");
    cb.type="checkbox";cb.className="chk";cb.checked=t.done;
    cb.onchange=()=>tasks[i].done=cb.checked;

    const span=document.createElement("div");
    span.className="txt";span.textContent=t.text;

    const del=document.createElement("button");
    del.className="del";del.textContent="ðŸ—‘";
    del.onclick=()=>{tasks.splice(i,1);render();};

    li.appendChild(cb);li.appendChild(span);li.appendChild(del);
    ul.appendChild(li);
  });
}
function addTask(){
  const input=document.getElementById("newText");
  const text=input.value.trim();
  if(!text)return;
  tasks.push({text,done:false});
  input.value="";input.focus();render();
}
async function save(){
  await fetch("/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(tasks)});
  if(navigator.vibrate)navigator.vibrate(20);
  alert("Saved âœ…");
}
document.getElementById("newText").addEventListener("keydown",e=>{if(e.key==="Enter")addTask();});
load();
</script>
</body>
</html>
